<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .upload-area {
            border: 2px dashed #28a745;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-area:hover {
            background-color: #e9ecef;
            border-color: #20c997;
        }
        .upload-area.dragover {
            background-color: #d4edda;
            border-color: #155724;
        }
        .prediction-card {
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .confidence-bar {
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.5s ease;
        }
        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .loading {
            display: none;
        }
        .result-section {
            display: none;
        }
        .navbar-brand {
            font-weight: bold;
        }
        .feature-card {
            transition: transform 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .batch-results {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-leaf"></i> Plant Disease Detection
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#single-upload">Single Upload</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#batch-upload">Batch Upload</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#model-info">Model Info</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="container-fluid bg-light py-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold text-success">AI-Powered Plant Disease Detection</h1>
                    <p class="lead">Upload images of plant leaves to detect diseases using our advanced CNN model. Get instant results with confidence scores.</p>
                    <div class="row mt-4">
                        <div class="col-md-4">
                            <div class="text-center">
                                <i class="fas fa-brain fa-2x text-success mb-2"></i>
                                <h6>AI-Powered</h6>
                                <small class="text-muted">Advanced CNN with 93%+ accuracy</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <i class="fas fa-bolt fa-2x text-success mb-2"></i>
                                <h6>Fast Results</h6>
                                <small class="text-muted">Get predictions in seconds</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <i class="fas fa-seedling fa-2x text-success mb-2"></i>
                                <h6>38 Diseases</h6>
                                <small class="text-muted">Detects multiple plant diseases</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <img src="https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=500&h=400&fit=crop" 
                         alt="Plant leaves" class="img-fluid rounded shadow">
                </div>
            </div>
        </div>
    </div>

    <!-- Single Upload Section -->
    <div class="container my-5" id="single-upload">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h2 class="text-center mb-4">
                    <i class="fas fa-upload text-success"></i> Single Image Upload
                </h2>
                
                <!-- Upload Area -->
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-cloud-upload-alt fa-3x text-success mb-3"></i>
                    <h4>Drop your image here or click to browse</h4>
                    <p class="text-muted">Supported formats: JPG, PNG, GIF, BMP, TIFF</p>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                </div>

                <!-- Loading -->
                <div class="loading text-center mt-4" id="loading">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Analyzing image...</p>
                </div>

                <!-- Results -->
                <div class="result-section" id="results">
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0"><i class="fas fa-image"></i> Uploaded Image</h5>
                                </div>
                                <div class="card-body text-center">
                                    <img id="imagePreview" class="image-preview" alt="Uploaded image">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card prediction-card">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Predictions</h5>
                                </div>
                                <div class="card-body" id="predictionResults">
                                    <!-- Predictions will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Batch Upload Section -->
    <div class="container-fluid bg-light py-5" id="batch-upload">
        <div class="container">
            <h2 class="text-center mb-4">
                <i class="fas fa-layer-group text-success"></i> Batch Upload
            </h2>
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="card">
                        <div class="card-body">
                            <div class="upload-area" id="batchUploadArea">
                                <i class="fas fa-images fa-3x text-success mb-3"></i>
                                <h4>Upload multiple images (max 10)</h4>
                                <p class="text-muted">Select multiple files for batch processing</p>
                                <input type="file" id="batchFileInput" accept="image/*" multiple style="display: none;">
                            </div>
                            
                            <div class="loading text-center mt-4" id="batchLoading">
                                <div class="spinner-border text-success" role="status">
                                    <span class="visually-hidden">Processing batch...</span>
                                </div>
                                <p class="mt-2">Processing images...</p>
                            </div>

                            <div class="batch-results mt-4" id="batchResults">
                                <!-- Batch results will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Info Section -->
    <div class="container my-5" id="model-info">
        <h2 class="text-center mb-4">
            <i class="fas fa-info-circle text-success"></i> Model Information
        </h2>
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card">
                    <div class="card-body" id="modelInfoContent">
                        <div class="text-center">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Loading model info...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="fas fa-leaf"></i> Plant Disease Detection</h5>
                    <p class="text-muted">AI-powered plant disease detection using advanced CNN technology.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="text-muted">Built with TensorFlow and Flask</p>
                    <p class="text-muted">&copy; 2024 Plant Disease Detection System</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Single upload functionality
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const imagePreview = document.getElementById('imagePreview');
        const predictionResults = document.getElementById('predictionResults');

        // Batch upload functionality
        const batchUploadArea = document.getElementById('batchUploadArea');
        const batchFileInput = document.getElementById('batchFileInput');
        const batchLoading = document.getElementById('batchLoading');
        const batchResults = document.getElementById('batchResults');

        // Single upload events
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);

        // Batch upload events
        batchUploadArea.addEventListener('click', () => batchFileInput.click());
        batchUploadArea.addEventListener('dragover', handleDragOver);
        batchUploadArea.addEventListener('drop', handleBatchDrop);
        batchFileInput.addEventListener('change', handleBatchFileSelect);

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                uploadFile(files[0]);
            }
        }

        function handleBatchDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                uploadBatchFiles(files);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                uploadFile(file);
            }
        }

        function handleBatchFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                uploadBatchFiles(files);
            }
        }

        function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);

            loading.style.display = 'block';
            results.style.display = 'none';

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                if (data.success) {
                    displayResults(data);
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                alert('Upload failed: ' + error);
            });
        }

        function uploadBatchFiles(files) {
            const formData = new FormData();
            for (let i = 0; i < Math.min(files.length, 10); i++) {
                formData.append('files', files[i]);
            }

            batchLoading.style.display = 'block';
            batchResults.innerHTML = '';

            fetch('/batch_upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                batchLoading.style.display = 'none';
                if (data.success) {
                    displayBatchResults(data.results);
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                batchLoading.style.display = 'none';
                alert('Batch upload failed: ' + error);
            });
        }

        function displayResults(data) {
            imagePreview.src = 'data:image/jpeg;base64,' + data.image;
            
            let html = '';
            data.predictions.forEach(pred => {
                const confidenceWidth = pred.percentage;
                html += `
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span class="fw-bold">${pred.class}</span>
                            <span class="badge bg-success">${pred.percentage.toFixed(1)}%</span>
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidenceWidth}%"></div>
                        </div>
                    </div>
                `;
            });
            
            predictionResults.innerHTML = html;
            results.style.display = 'block';
        }

        function displayBatchResults(results) {
            let html = '<h5 class="mb-3">Batch Processing Results</h5>';
            
            results.forEach((result, index) => {
                html += `
                    <div class="card mb-2">
                        <div class="card-body">
                            <h6 class="card-title">${result.filename}</h6>
                `;
                
                if (result.error) {
                    html += `<div class="alert alert-danger">${result.error}</div>`;
                } else if (result.top_prediction) {
                    html += `
                        <div class="d-flex justify-content-between align-items-center">
                            <span>${result.top_prediction.class}</span>
                            <span class="badge bg-success">${result.top_prediction.percentage.toFixed(1)}%</span>
                        </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            batchResults.innerHTML = html;
        }

        // Load model info
        fetch('/model_info')
        .then(response => response.json())
        .then(data => {
            const modelInfoContent = document.getElementById('modelInfoContent');
            if (data.error) {
                modelInfoContent.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
            } else {
                modelInfoContent.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <h5><i class="fas fa-cog"></i> Model Architecture</h5>
                            <ul class="list-unstyled">
                                <li><strong>Input Shape:</strong> ${JSON.stringify(data.input_shape)}</li>
                                <li><strong>Output Shape:</strong> ${JSON.stringify(data.output_shape)}</li>
                                <li><strong>Total Parameters:</strong> ${data.total_parameters.toLocaleString()}</li>
                                <li><strong>Image Size:</strong> ${data.image_size}x${data.image_size}</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="fas fa-list"></i> Supported Classes</h5>
                            <p><strong>Total Classes:</strong> ${data.num_classes}</p>
                            <div class="small text-muted">
                                Sample classes: ${data.class_names.slice(0, 5).join(', ')}...
                            </div>
                        </div>
                    </div>
                `;
            }
        })
        .catch(error => {
            document.getElementById('modelInfoContent').innerHTML = 
                `<div class="alert alert-danger">Failed to load model info: ${error}</div>`;
        });
    </script>
</body>
</html>